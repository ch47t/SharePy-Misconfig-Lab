server {
    listen 80;
    server_name localhost;

    # üõ°Ô∏è 1. SUPPRESSION DE LA BANNI√àRE (M10)
    # Emp√™che Nginx d'afficher sa version dans les en-t√™tes et les pages d'erreur
    server_tokens off;

    # üõ°Ô∏è 2. HEADERS DE S√âCURIT√â (M8)
    
    # HSTS (Strict-Transport-Security)
    # Force le navigateur √† utiliser HTTPS pour les futures connexions (m√™me si on est en HTTP ici pour le lab)
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # X-Frame-Options
    # Emp√™che l'int√©gration du site dans une <frame> ou <iframe> (Protection contre le Clickjacking)
    add_header X-Frame-Options "SAMEORIGIN" always;

    # X-Content-Type-Options
    # Emp√™che le navigateur de deviner le type de fichier (MIME Sniffing)
    add_header X-Content-Type-Options "nosniff" always;

    # Content-Security-Policy (CSP)
    # Une politique stricte pour mitiger les XSS. 
    # On autorise les scripts locaux ('self') et le style inline (souvent utilis√© en dev).
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; object-src 'none'; base-uri 'self';" always;

    # Referrer-Policy
    # Contr√¥le quelles infos sont envoy√©es quand on clique sur un lien sortant
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # Permissions-Policy
    # D√©sactive les fonctionnalit√©s sensibles du navigateur (cam√©ra, micro, etc.)
    add_header Permissions-Policy "geolocation=(), midi=(), sync-xhr=(), microphone=(), camera=(), magnetometer=(), gyroscope=(), fullscreen=(self), payment=()" always;

    # ... Le reste de votre configuration (root /app, locations, etc.) ...
    root /app;

    location / {
        try_files $uri @backend;
    }

    location @backend {
        proxy_pass http://backend:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # (Assurez-vous d'avoir retir√© les mauvaises configs M3/M4/M11 ici aussi !)
}
